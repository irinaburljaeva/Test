<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/>
<title>–°–ø—Ä–æ—Å–∏—Ç–µ —É –∫–∞—Ä—Ç ‚Äî –∏–¥—Ç–∏ –ª–∏ –Ω–∞ –û—Å—Ç—Ä–æ–≤ –°—Ç—Ä–æ–π–Ω–æ—Å—Ç–∏?</title>
<meta name="description" content="–ü–æ—Ç—è–Ω–∏—Ç–µ –∫–∞—Ä—Ç—É –∏ –ø–æ–ª—É—á–∏—Ç–µ –∑–Ω–∞–∫ –æ—Ç –≤—Å–µ–ª–µ–Ω–Ω–æ–π: –∏–¥—Ç–∏ –ª–∏ –≤–∞–º –Ω–∞ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –º–∞—Ä–∞—Ñ–æ–Ω ¬´–û—Å—Ç—Ä–æ–≤ –°—Ç—Ä–æ–π–Ω–æ—Å—Ç–∏¬ª. 7 —Å–µ–∫—É–Ω–¥ ‚Äî –∏ –æ—Ç–≤–µ—Ç!"/>
<meta name="color-scheme" content="light only"/>
<style>
  :root{
    --red:#CF2C02; --yellow:#FFBA08; --orange:#E85D04;
    --white:#fff; --gray:#D9D9D9; --ink:#1a1a1a;
    --radius:20px; --shadow:0 10px 30px rgba(0,0,0,.12);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial;
    color:var(--ink);
    background:
      radial-gradient(1200px 800px at 80% -10%, rgba(255,186,8,.25), transparent 60%),
      radial-gradient(900px 700px at -10% 110%, rgba(232,93,4,.18), transparent 60%),
      linear-gradient(180deg,#fff,#fff);
    display:flex; align-items:center; justify-content:center; padding:16px;
  }
  .app{width:min(520px,100%);}
  .card{
    background:var(--white); border-radius:calc(var(--radius) + 6px);
    box-shadow:var(--shadow); padding:20px 18px; position:relative; overflow:hidden;
  }
  .badge{
    position:absolute; top:14px; right:14px; font-size:12px; letter-spacing:.08em;
    background:var(--yellow); color:#6a3b00; padding:6px 10px; border-radius:999px; font-weight:700;
  }
  h1{margin:8px 0 8px; font-size:26px; line-height:1.15}
  p.lead{margin:0 0 16px; color:#444}

  /* –ö–æ–ª–æ–¥–∞: –¥–≤–∞ —Ä–µ–∂–∏–º–∞ ‚Äî fan (—Å—Ç—É–ø–µ–Ω—å–∫–æ–π) –∏ triple (3 –∫–∞—Ä—Ç—ã) */
  .deck{margin:18px 0 8px}
  .deck.fan{
    position:relative;
    height: 260px; /* –∞–≤—Ç–æ –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è JS-–æ–º; —Å—Ç–∞—Ä—Ç–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ */
  }
  .deck.triple{
    display:flex; justify-content:center; gap:12px;
  }

  .tarot{
    width:96px; height:148px; border-radius:14px; background:#fff;
    border:2px solid #eee; box-shadow:0 10px 18px rgba(0,0,0,.12);
    transform-origin:center; transition:transform .25s ease, filter .25s ease; cursor:pointer;
    position:relative; overflow:hidden; display:grid; place-items:center;
  }
  .deck.fan .tarot{
    position:absolute; /* –±—É–¥–µ–º —Ä–∞—Å–∫–ª–∞–¥—ã–≤–∞—Ç—å —Å—Ç—É–ø–µ–Ω—å–∫–æ–π –∏ —Å–ª–µ–≥–∫–∞ –≤–µ–µ—Ä–æ–º */
    left:50%; margin-left:-48px; /* —Ü–µ–Ω—Ç—Ä –∫–∞—Ä—Ç—ã */
  }
  .tarot img{width:100%; height:100%; object-fit:cover; display:block}
  .tarot:hover{transform:translateY(-4px) rotate(-2deg); filter:brightness(1.02)}

  .actions{display:grid; gap:10px; margin:14px 0 4px}
  .btn{
    appearance:none; border:0; border-radius:16px; padding:14px 16px; font-size:16px;
    font-weight:800; cursor:pointer; transition:transform .06s ease, box-shadow .2s ease;
  }
  .btn-primary{background:var(--red); color:#fff; box-shadow:0 10px 22px rgba(207,44,2,.28)}
  .btn-primary:active{transform:translateY(1px)}
  .btn-secondary{background:#fff; color:#333; border:2px solid var(--gray)}
  .footer{text-align:center; font-size:12px; color:#666; margin-top:12px}
  .brand{display:flex; align-items:center; gap:8px; font-weight:700; margin-top:10px}
  .dot{width:10px; height:10px; border-radius:50%; background:var(--red)}

  .progress{display:flex; align-items:center; gap:10px; font-size:12px; color:#666; margin:8px 0 0}
  .bar{height:8px; background:#f2f2f2; border-radius:999px; overflow:hidden; flex:1}
  .bar>i{display:block; height:100%; width:0%; background:linear-gradient(90deg,var(--yellow),var(--orange)); transition:width .8s ease}

  /* Modal */
  .modal{position:fixed; inset:0; display:none; place-items:center; padding:20px;
    background:rgba(0,0,0,.35); backdrop-filter:blur(4px); z-index:10;}
  .modal.open{display:grid}
  .sheet{width:min(520px,100%); background:#fff; border-radius:26px; box-shadow:var(--shadow);
    padding:18px; position:relative; overflow:hidden;}
  .ribbon{position:absolute; inset:auto -40px auto -40px; top:0; height:110px;
    background:conic-gradient(from 0deg at 50% 50%, #fff 0 20%, rgba(255,186,8,.16) 20% 60%, rgba(232,93,4,.14) 60% 100%);
    filter:blur(18px); opacity:.9; pointer-events:none;}
  .result-title{margin:4px 0 6px; font-size:22px}
  .pill{display:inline-block; padding:6px 10px; border-radius:999px; font-weight:700; font-size:12px}
  .pill-yes{background:rgba(207,44,2,.12); color:var(--red)}
  .pill-soft{background:rgba(232,93,4,.14); color:var(--orange)}
  .pill-joke{background:rgba(0,0,0,.06); color:#333}
  .result-card{margin:12px 0 14px; border:2px dashed #eee; border-radius:18px; padding:14px;
    background:radial-gradient(600px 140px at 50% -40%, rgba(255,186,8,.18), transparent 50%),#fff;}
  .cta{display:grid; gap:10px; margin-top:12px}
  .note{font-size:12px; color:#666; text-align:center}

  /* Flip card ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–∏—Ü–æ –∫–∞—Ä—Ç–∏–Ω–∫–æ–π */
  .flip{perspective:1000px; width:180px; height:260px; margin:0 auto 10px; position:relative;}
  .flip-inner{position:absolute; inset:0; transform-style:preserve-3d; transition:transform .8s ease;}
  .flip.flipped .flip-inner{transform:rotateY(180deg)}
  .flip-face{position:absolute; inset:0; backface-visibility:hidden; border-radius:20px; overflow:hidden;
    box-shadow:0 10px 24px rgba(0,0,0,.18);}
  .flip-front{background:repeating-linear-gradient(45deg,#fafafa 0 12px,#f2f2f2 12px 24px); display:grid; place-items:center; color:#bbb; font-size:28px}
  .flip-back{background:#fff; transform:rotateY(180deg); border:2px solid var(--gray); display:grid; place-items:center; padding:0}
  .flip-back img{width:100%; height:100%; object-fit:cover; display:block; border-radius:18px}

  .kpi{margin-top:8px; font-size:12px; color:#666; text-align:center}
  .kpi b{color:#000}

  @media (min-width:540px){ h1{font-size:28px} }
</style>
</head>
<body>
  <main class="app">
    <section class="card" aria-labelledby="title">
      <div class="badge">7 —Å–µ–∫—É–Ω–¥</div>
      <h1 id="title">–°–ø—Ä–æ—Å–∏—Ç–µ —É –∫–∞—Ä—Ç: –∏–¥—Ç–∏ –ª–∏ –Ω–∞ <span style="color:#E85D04;font-weight:800">–û—Å—Ç—Ä–æ–≤ –°—Ç—Ä–æ–π–Ω–æ—Å—Ç–∏</span> —Å–µ–π—á–∞—Å?</h1>
      <p class="lead">–°–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ –≤–æ–ø—Ä–æ—Å–µ, —Å–¥–µ–ª–∞–π—Ç–µ –≤–¥–æ—Ö –∏ –ø–æ—Ç—è–Ω–∏—Ç–µ –æ–¥–Ω—É –∫–∞—Ä—Ç—É. –í—Å–µ–ª–µ–Ω–Ω–∞—è –ª—é–±–∏—Ç —Ä–µ—à–∏—Ç–µ–ª—å–Ω—ã—Ö ‚ú®</p>

      <div class="deck fan" id="deck" role="list" aria-label="–ö–æ–ª–æ–¥–∞"></div>

      <div class="actions">
        <button class="btn btn-primary" id="draw">–ü–æ—Ç—è–Ω—É—Ç—å –∫–∞—Ä—Ç—É</button>
        <button class="btn btn-secondary" id="shuffle" aria-label="–ü–µ—Ä–µ—Ç–∞—Å–æ–≤–∞—Ç—å –∫–æ–ª–æ–¥—É">–ü–µ—Ä–µ—Ç–∞—Å–æ–≤–∞—Ç—å ‚ú¶</button>
      </div>

      <div class="progress" aria-hidden="true">
        <span>–°–∏–≥–Ω–∞–ª –≤—Å–µ–ª–µ–Ω–Ω–æ–π</span>
        <div class="bar"><i id="bar"></i></div>
      </div>

      <div class="kpi">–£–∂–µ —Å–ø—Ä–æ—Å–∏–ª–∏: <b id="asked">53</b> —á–µ–ª–æ–≤–µ–∫</div>

      <div class="footer">
        –ù–∞–∂–∏–º–∞—è –Ω–∞ –∫–∞—Ä—Ç—É, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å –ø—Ä–∏—Å–ª—É—à–∞—Ç—å—Å—è –∫ —Å–µ–±–µ, –∞ –Ω–µ –∫ –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏–∏ üòä
        <div class="brand"><i class="dot"></i> –®–ê–ì–ê–ô –î–û–ú–ê</div>
      </div>
    </section>
  </main>

  <!-- Modal -->
  <aside class="modal" id="modal" role="dialog" aria-modal="true" aria-labelledby="rtitle">
    <div class="sheet">
      <div class="ribbon"></div>

      <div class="flip" id="flip">
        <div class="flip-inner">
          <div class="flip-face flip-front">‚òÖ</div>
          <div class="flip-face flip-back">
            <img id="resultImg" src="" alt="–í—ã–ø–∞–≤—à–∞—è –∫–∞—Ä—Ç–∞">
          </div>
        </div>
      </div>

      <div class="result-card">
        <span class="pill" id="pill">–ü–û–î–°–ö–ê–ó–ö–ê</span>
        <h2 class="result-title" id="rtitle">–í–∞—à –∑–Ω–∞–∫ –ø–æ–ª—É—á–µ–Ω</h2>
        <p id="text">‚Ä¶</p>
      </div>

      <div class="cta">
        <a id="cta" class="btn btn-primary" href="https://walk-walk.ru/happyisland?utm_source=website&utm_medium=app&utm_campaign=taro&utm_term=smm" target="_blank" rel="noopener">–ò–¥—É –Ω–∞ ¬´–û—Å—Ç—Ä–æ–≤ –°—Ç—Ä–æ–π–Ω–æ—Å—Ç–∏¬ª</a>
        <button class="btn btn-secondary" id="again">–ü–æ—Ç—è–Ω—É—Ç—å –µ—â—ë —Ä–∞–∑</button>
      </div>

      <p class="note">–ü–æ–¥—Å–∫–∞–∑–∫–∏ ‚Äî —ç—Ç–æ –ø—Ä–æ –≤—ã–±–æ—Ä. –í—ã —Ä–µ—à–∞–µ—Ç–µ, –∫–æ–≥–¥–∞ –Ω–∞—á–∞—Ç—å. –ú—ã ‚Äî —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏–ª–æ—Å—å.</p>
    </div>
  </aside>

<script>
(function(){
  /* ==== –†–ï–ñ–ò–ú –†–ê–°–ö–õ–ê–î–ö–ò ==== 
     'fan'    ‚Äî —Å—Ç—É–ø–µ–Ω—å–∫–æ–π —Å –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ–º (–∫–∞–∫ –∫–æ–ª–æ–¥–∞ –≤ —Ä—É–∫–∞—Ö)
     'triple' ‚Äî –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ 3 –∫–∞—Ä—Ç—ã
  */
  const MODE = 'fan';    // –ø–æ–º–µ–Ω—è–π –Ω–∞ 'triple' –¥–ª—è —Å—Ç–∞—Ä–æ–≥–æ –≤–∏–¥–∞
  const NUM_CARDS = (MODE==='fan' ? 9 : 3);

  // —Å—Å—ã–ª–∫–∏
  const URL_INTENSIVE = "https://walk-walk.ru/happyisland?utm_source=website&utm_medium=app&utm_campaign=taro&utm_term=smm";
  const URL_CLUB      = "https://walk-walk.ru/?utm_source=website&utm_medium=app&utm_campaign=taro&utm_term=club";

  // —Ñ–∞–π–ª—ã
  const BACK_IMG = "taro.png";
  const CLUB_IMG = "karta1.png";
  const FACE_IMGS = ["karta2.png","karta3.png","karta4.png","karta5.png","karta6.png","karta7.png"];

  // –≤–µ—Å–∞ –∏ —Ç–µ–∫—Å—Ç—ã
  const WEIGHTS = { yes:0.85, soft:0.10, joke:0.05 };
  const YES = [
    "–í—Å–µ–ª–µ–Ω–Ω–∞—è –¥–∞–ª–∞ —Å–≤–æ–π –∑–Ω–∞–∫! –í–∞–º —Ç–æ—á–Ω–æ –Ω—É–∂–Ω–æ –Ω–∞ ¬´–û—Å—Ç—Ä–æ–≤ –°—Ç—Ä–æ–π–Ω–æ—Å—Ç–∏¬ª.",
    "–ö–∞—Ä—Ç–∞ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç: –ø–µ—Ä–≤—ã–µ —à–∞–≥–∏ —É–∂–µ —Å–∫–æ—Ä–æ –∏–∑–º–µ–Ω—è—Ç –≤–∞—à—É –∂–∏–∑–Ω—å!",
    "–î–∞! –≠–Ω–µ—Ä–≥–∏—è –ø–µ—Ä–µ–º–µ–Ω —Å–∏–ª—å–Ω–∞ ‚Äî –Ω–∞—á–Ω–∏—Ç–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å.",
    "–í—Å–µ–ª–µ–Ω–Ω–∞—è —à–µ–ø—á–µ—Ç: –∏–º–µ–Ω–Ω–æ —Å–µ–π—á–∞—Å —Å–∞–º–æ–µ –≤—Ä–µ–º—è –¥–ª—è –≤–∞—à–µ–≥–æ —à–∞–≥–∞.",
    "–ö–∞—Ä—Ç–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç –¥–æ—Ä–æ–≥—É –∫ –ª—ë–≥–∫–æ—Å—Ç–∏ –∏ —ç–Ω–µ—Ä–≥–∏–∏ ‚Äî –Ω–∞ ¬´–û—Å—Ç—Ä–æ–≤ –°—Ç—Ä–æ–π–Ω–æ—Å—Ç–∏¬ª.",
    "–î–∞, –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∏–¥—ë—Ç –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º –≤—ã –¥—É–º–∞–µ—Ç–µ.",
    "–°–∏–≥–Ω–∞–ª —è—Å–µ–Ω: –ø–æ—Ä–∞ –æ–±–Ω–æ–≤–∏—Ç—å—Å—è ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ—Å—å –Ω–∞ ¬´–û—Å—Ç—Ä–æ–≤ –°—Ç—Ä–æ–π–Ω–æ—Å—Ç–∏¬ª.",
    "–í–∞—à –ø—É—Ç—å –æ—Å–≤–µ—â—ë–Ω. –ü–µ—Ä–≤—ã–π —à–∞–≥ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∑–¥–µ—Å—å.",
    "–ö–∞—Ä—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–∞: —Å–µ–≥–æ–¥–Ω—è –ª—É—á—à–∏–π –¥–µ–Ω—å, —á—Ç–æ–±—ã —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å.",
    "–ó–Ω–∞–∫ –ø–æ–ª—É—á–µ–Ω: –≤–ø–µ—Ä—ë–¥ –Ω–∞ ¬´–û—Å—Ç—Ä–æ–≤ –°—Ç—Ä–æ–π–Ω–æ—Å—Ç–∏¬ª!"
  ];
  const SOFT = [
    "–í—Ä–µ–º—è –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω –±–ª–∏–∑–∫–æ ‚Äî —Å–¥–µ–ª–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π —à–∞–≥ –±–µ—Ä–µ–∂–Ω–æ.",
    "–ö–∞—Ä—Ç–∞ —Å–æ–≤–µ—Ç—É–µ—Ç: –Ω–∞—á–Ω–∏—Ç–µ –±–µ–∑ —Å–ø–µ—à–∫–∏, –Ω–æ –Ω–∞—á–Ω–∏—Ç–µ.",
    "–î–∞, –Ω–æ –º—è–≥–∫–æ: –≤—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–π —É—Ä–æ–≤–µ–Ω—å –∏ –¥–≤–∏–≥–∞–π—Ç–µ—Å—å –≤ —Å–≤–æ—ë–º —Ç–µ–º–ø–µ.",
    "–ö–∞—Ä—Ç–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç: —Å–∏–ª–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —à–∞–≥–æ–≤ –∏–∑–º–µ–Ω–∏—Ç –≤—Å—ë.",
    "–°–µ–≥–æ–¥–Ω—è –∑–Ω–∞–∫ –æ—Å–æ–±–µ–Ω–Ω–æ —è—Å–µ–Ω: –Ω–∞—á–Ω–∏—Ç–µ –º—è–≥–∫–æ, –∏ –≤—Å—ë –ø–æ–ª—É—á–∏—Ç—Å—è."
  ];
  const JOKE = [
    "–£–≤—ã, –∫–∞—Ä—Ç—ã –ø–æ–∫–∞–∑–∞–ª–∏, —á—Ç–æ –≤–∞–º –ª—É—á—à–µ –∫—É–ø–∏—Ç—å –ø—Ä–æ—Å—Ç–æ –∞–±–æ–Ω–µ–º–µ–Ω—Ç –≤ –∫–ª—É–±‚Ä¶",
    "–ö–∞—Ä—Ç–∞ –Ω–∞–º–µ–∫–Ω—É–ª–∞: –≤—ã –∏ —Ç–∞–∫ —Å–ª–∏—à–∫–æ–º —Ö–∞—Ä–∏–∑–º–∞—Ç–∏—á–Ω—ã üòè –í–∞–º –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–ª—É–±–∞.",
    "–í—Å–µ–ª–µ–Ω–Ω–∞—è –ø–æ—à—É—Ç–∏–ª–∞: –æ—Å—Ç—Ä–æ–≤ –ø–æ–¥–æ–∂–¥—ë—Ç, –∞ –∫–ª—É–± –æ—Ç–∫—Ä—ã—Ç –≤—Å–µ–≥–¥–∞."
  ];

  // DOM
  const deck    = document.getElementById('deck');
  const bar     = document.getElementById('bar');
  const modal   = document.getElementById('modal');
  const pill    = document.getElementById('pill');
  const rtitle  = document.getElementById('rtitle');
  const textEl  = document.getElementById('text');
  const cta     = document.getElementById('cta');
  const again   = document.getElementById('again');
  const flip    = document.getElementById('flip');
  const resultImg = document.getElementById('resultImg');
  const askedEl = document.getElementById('asked');
  const drawBtn = document.getElementById('draw');
  const shuffleBtn = document.getElementById('shuffle');

  // –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞
  [BACK_IMG, CLUB_IMG, ...FACE_IMGS].forEach(src => { const i = new Image(); i.src = src; });

  // —Å—Ç–∞—Ä—Ç —Å—á—ë—Ç—á–∏–∫–∞ 50..60
  try{
    if(!localStorage.getItem('askedCount')){
      const base = 50 + Math.floor(Math.random()*11); // 50..60
      localStorage.setItem('askedCount', String(base));
    }
    askedEl.textContent = parseInt(localStorage.getItem('askedCount'),10).toLocaleString('ru-RU');
  }catch(e){}

  // –∏—Å—Ç–æ—Ä–∏—è –ø–æ –ª–∏—Ü–∞–º
  const KEY = 'ww_tarot_seen_faces_v2';
  function loadHistory(){ try{ return JSON.parse(localStorage.getItem(KEY)||'[]'); }catch(e){ return []; } }
  function saveHistory(h){ try{ localStorage.setItem(KEY, JSON.stringify(h.slice(-6))); }catch(e){} }

  function pickFrom(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
  function pickTone(){
    const r = Math.random();
    if (r < WEIGHTS.yes) return 'yes';
    if (r < WEIGHTS.yes + WEIGHTS.soft) return 'soft';
    return 'joke';
  }
  function pillClass(tone){ return tone==='yes' ? 'pill-yes' : tone==='soft' ? 'pill-soft' : 'pill-joke'; }
  function titleByTone(tone){
    if(tone==='yes')  return '–ó–Ω–∞–∫ –ø–æ–ª—É—á–µ–Ω: –î–ê';
    if(tone==='soft') return '–ó–Ω–∞–∫ –ø–æ–ª—É—á–µ–Ω: –î–ê, –Ω–æ –±–µ—Ä–µ–∂–Ω–æ';
    return '–†–µ–¥–∫–∏–π –∑–Ω–∞–∫: —à—É—Ç–∫–∞ –æ—Ç –≤—Å–µ–ª–µ–Ω–Ω–æ–π';
  }

  function pickOutcome(){
    const hist = loadHistory();
    const banned = new Set(hist);

    let tone = pickTone();
    if (tone==='joke' && banned.has(CLUB_IMG)){
      tone = (Math.random() < 0.5) ? 'soft' : 'yes';
    }

    let face, text, link;
    if (tone==='joke'){
      face = CLUB_IMG; text = pickFrom(JOKE); link = URL_CLUB;
    } else {
      const available = FACE_IMGS.filter(f=>!banned.has(f));
      const pool = available.length ? available : FACE_IMGS;
      face = pickFrom(pool);
      text = (tone==='yes') ? pickFrom(YES) : pickFrom(SOFT);
      link = URL_INTENSIVE;
    }

    hist.push(face);
    saveHistory(hist);
    return {tone, face, text, link};
  }

  function animateBar(){
    bar.style.width = '0%';
    requestAnimationFrame(()=>{ setTimeout(()=>{ bar.style.width = '100%' }, 60);});
  }
  function openResult(){ modal.classList.add('open'); setTimeout(()=>flip.classList.add('flipped'),80); }
  function closeResult(){ modal.classList.remove('open'); flip.classList.remove('flipped'); }

  function onDraw(){
    animateBar();
    setTimeout(()=>{
      const res = pickOutcome();
      resultImg.src = res.face;
      resultImg.alt = "–ö–∞—Ä—Ç–∞";
      pill.className = 'pill ' + pillClass(res.tone);
      rtitle.textContent = titleByTone(res.tone);
      textEl.textContent = res.text;
      cta.href = res.link;
      cta.textContent = (res.tone==='joke') ? '–í –∫–ª—É–± ‚Üí' : '–ò–¥—É –Ω–∞ ¬´–û—Å—Ç—Ä–æ–≤ –°—Ç—Ä–æ–π–Ω–æ—Å—Ç–∏¬ª';

      try{
        const base = parseInt(localStorage.getItem('askedCount') || '50', 10);
        const next = base + 1;
        localStorage.setItem('askedCount', String(next));
        askedEl.textContent = next.toLocaleString('ru-RU');
      }catch(e){}

      openResult();
    }, 800);
  }

  // –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–æ–ª–æ–¥—ã
  function buildDeck(){
    deck.classList.toggle('fan', MODE==='fan');
    deck.classList.toggle('triple', MODE==='triple');
    deck.innerHTML = '';

    if (MODE==='triple'){
      for(let i=0;i<3;i++){
        const btn = document.createElement('button');
        btn.className = 'tarot';
        const img = document.createElement('img'); img.src = BACK_IMG; img.alt='–†—É–±–∞—à–∫–∞ –∫–∞—Ä—Ç—ã';
        btn.appendChild(img);
        // –Ω–µ–±–æ–ª—å—à–æ–π —Ä–∞–Ω–¥–æ–º –∫–∞–∫ –±—ã–ª–æ
        const r = (Math.random()*6-3), y=(Math.random()*6-3);
        btn.style.transform = `translateY(${y}px) rotate(${r}deg)`;
        btn.addEventListener('click', onDraw);
        deck.appendChild(btn);
      }
      return;
    }

    // FAN: —Å—Ç—É–ø–µ–Ω—å–∫–æ–π —Å –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ–º —Å–Ω–∏–∑—É –∏ –ª—ë–≥–∫–∏–º –≤–µ–µ—Ä–æ–º
    const overlap = 22;              // –Ω–∞—Å–∫–æ–ª—å–∫–æ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—Ç—å –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ (px)
    const baseTop = 8;               // –æ—Ç—Å—Ç—É–ø –≤–µ—Ä—Ö–Ω–µ–π –∫–∞—Ä—Ç—ã
    const mid = (NUM_CARDS-1)/2;     // –¥–ª—è –≤–µ–µ—Ä–∞
    const maxTilt = 7;               // –º–∞–∫—Å. —É–≥–æ–ª –≤–µ–µ—Ä–∞ (–≥—Ä–∞–¥—É—Å—ã)
    const spreadX = 6;               // —Ä–∞–∑–Ω–æ—Å –ø–æ X –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –≤–µ–µ—Ä–∞ (px)

    // –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –≤—ã—Å–æ—Ç–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, —á—Ç–æ–±—ã –≤–ª–µ–∑–ª–∏ –≤—Å–µ –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏—è
    deck.style.height = (148 + baseTop + overlap*(NUM_CARDS-1)) + 'px';

    for(let i=0;i<NUM_CARDS;i++){
      const btn = document.createElement('button');
      btn.className = 'tarot';
      btn.setAttribute('aria-label','–ü–æ—Ç—è–Ω—É—Ç—å –∫–∞—Ä—Ç—É ' + (i+1));
      const img = document.createElement('img'); img.src = BACK_IMG; img.alt='–†—É–±–∞—à–∫–∞ –∫–∞—Ä—Ç—ã';
      btn.appendChild(img);

      // –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
      const top = baseTop + i*overlap;
      const tilt = ((i - mid) / mid) * maxTilt;          // -maxTilt..+maxTilt
      const shiftX = ((i - mid) / mid) * spreadX;        // -spreadX..+spreadX

      btn.style.top = top + 'px';
      btn.style.transform = `translateX(${shiftX}px) rotate(${tilt.toFixed(2)}deg)`;
      btn.style.zIndex = String(100 + i); // –≤–µ—Ä—Ö–Ω—è—è –∫–∞—Ä—Ç–∞ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–µ–µ

      btn.addEventListener('click', onDraw);
      deck.appendChild(btn);
    }
  }

  function reshuffle(){
    if (MODE==='triple'){
      [...deck.children].forEach(el=>{
        const r = (Math.random()*6-3), y=(Math.random()*6-3);
        el.style.transform = `translateY(${y}px) rotate(${r}deg)`;
      });
    } else {
      // –Ω–µ–±–æ–ª—å—à–æ–π ¬´–¥—Ä–æ–∂–∞—â–∏–π¬ª reshuffle –¥–ª—è –≤–µ–µ—Ä–∞
      const mid = (NUM_CARDS-1)/2, maxTilt=7, spreadX=6;
      [...deck.children].forEach((el, i)=>{
        const tilt = ((i - mid) / mid) * maxTilt + (Math.random()*2-1)*0.6;
        const shiftX = ((i - mid) / mid) * spreadX + (Math.random()*2-1)*1.2;
        el.style.transform = `translateX(${shiftX.toFixed(2)}px) rotate(${tilt.toFixed(2)}deg)`;
      });
    }
  }

  // —Å–æ–±—ã—Ç–∏—è
  buildDeck();
  document.getElementById('draw').addEventListener('click', onDraw);
  document.getElementById('shuffle').addEventListener('click', reshuffle);
  document.getElementById('again').addEventListener('click', ()=>{ modal.classList.remove('open'); flip.classList.remove('flipped'); setTimeout(reshuffle,260); });

})();
</script>
</body>
</html>
